<%= javascript_include_tag "uploadify/swfobject", "uploadify/jquery.uploadify.v2.1.4.min" %>

<script type="text/javascript" charset="utf-8">
<%- session_key = Rails.application.config.session_options[:key] -%>

$(document).ready(function(){
    
  var uploadify_script_data = {};
  
  // Fetch the CSRF meta tag data
	var csrf_token = $('meta[name=csrf-param]').attr('content'); // token_name
	var csrf_param = $('meta[name=csrf-token]').attr('content'); // token content
	// Now associate the data in the config, encoding the data safely
	uploadify_script_data[csrf_token] = encodeURI(encodeURIComponent(csrf_param));
  // Associate the session information
    uploadify_script_data['<%= session_key %>'] = '<%= cookies[session_key] %>';

  $('#picture_photo').uploadify({
		uploader 		: '/javascripts/uploadify/uploadify.swf',
  		script    		: '/pictures',
  		multi      		: true,
  		cancelImg		: '/images/cancel.png',
        scriptData      : uploadify_script_data,
		buttonText  	: 'select files',
		user_id         : '<%= @user.id %>'
  });
  
 $('#picture_submit').click(function(event){
    event.preventDefault();
    $('#picture_photo').uploadifyUpload();
  });
});


</script>
